<!DOCTYPE html>
<html>
<head>
  <title>QR Code Reader</title>
</head>
<body>
    <p>QR Code Reader</p>
    <canvas id="canvas" width="640" height="480"></canvas>
    <p>QR Code Reader</p>

    <script src="./jsqr/jsqr.js"></script>
    <script>
        // draw a circle to the middle of the canvas with radius 66% of the height of the canvas
        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext('2d');
        ctx.beginPath();
        ctx.arc(canvas.width / 2, canvas.height / 2, canvas.height / 3, 0, 2 * Math.PI);
        ctx.fillStyle = 'red';
        ctx.fill(); 
    
        // turn on the camera
        var video = document.createElement('video');
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
                video.play();
            })
            .catch(err => {
                console.error('Error accessing the camera:', err);
            });
        
        // show the camera preview in the canvas
        video.addEventListener('play', () => {
            drawVideo();
        });
    
        function drawVideo() {
            if (video.paused || video.ended) {
                return;
            }
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            // write console "image is updated"
            console.log('image is updated');

            // get image data from canvas
            var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            // decode the QR code from the image data
            var code = jsQR(imageData.data, imageData.width, imageData.height);
            if (code) {
                console.log('QR Code detected: ' + code.data);
            }

            requestAnimationFrame(drawVideo);
        }
    
        // the video didn't show on the canvas
        if (!canvas.getContext) {
            alert('Your browser does not support the HTML5 canvas element.');
        }
    </script>

</body>
</html>
